<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaleoFlow</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #000; color: white; padding: 10px; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; margin: 0; overflow-x: hidden;
        }

        /* --- STYLIZED LABELS --- */
        .timer-container { text-align: center; margin-top: 15px; }
        
        .flow-label { 
            font-size: 2.2rem; font-weight: 900; letter-spacing: 10px; 
            background: linear-gradient(90deg, #00d2ff, #3a7bd5, #00d2ff);
            background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: wave-blue 3s linear infinite; filter: drop-shadow(0 0 15px rgba(0, 210, 255, 0.7));
        }

        .shift-label { 
            font-size: 1.8rem; font-weight: 900; letter-spacing: 6px; 
            text-transform: uppercase; margin-top: 5px;
            background-size: 300% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: spectrum-wave 4s linear infinite;
        }

        #total-flow { font-size: 3.8rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; margin-top: 5px;}
        #next-shift { font-family: 'Courier New', monospace; font-size: 2rem; font-weight: bold; color: #888; margin-top: 5px;}

        @keyframes wave-blue { to { background-position: 200% center; } }
        @keyframes spectrum-wave { to { background-position: 300% center; } }

        /* --- HUD LAYOUT --- */
        .hud-container { display: flex; align-items: center; justify-content: center; width: 100%; max-width: 520px; margin: 20px 0; }
        .phase-column { display: flex; flex-direction: column; gap: 8px; }
        
        .phase-btn {
            width: 75px; height: 36px; border-radius: 18px; border: 1px solid #222;
            background: #0a0a0a; color: #fff; font-size: 0.65rem; font-weight: 900;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: all 0.2s ease; white-space: nowrap;
        }

        #dashboard { position: relative; width: 220px; height: 220px; margin: 0 5px; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 10; stroke-linecap: round; transition: all 0.8s ease; }
        .bg-ring { stroke: #111; }
        
        #center-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 140px; }
        #phase-name { font-size: 0.85rem; font-weight: 900; letter-spacing: 1px; color: #fff; text-transform: uppercase; }
        #biological-action { font-size: 0.5rem; color: #666; font-weight: bold; margin-top: 5px; text-transform: uppercase; }

        .main-btn { background: #fff; color: #000; border: none; padding: 22px 55px; border-radius: 60px; font-weight: 900; font-size: 1.1rem; margin-top: 25px; cursor: pointer; letter-spacing: 2px; text-transform: uppercase; }
        
        #history { width: 100%; max-width: 450px; margin-top: 50px; padding-bottom: 50px; }
        .history-header { display: flex; justify-content: space-between; border-bottom: 2px solid #222; padding-bottom: 12px; }
        .log-entry { border-bottom: 1px solid #1a1a1a; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="timer-container">
        <div class="flow-label">FLOW</div>
        <div id="total-flow">00:00:00</div>
    </div>

    <div class="hud-container">
        <div class="phase-column">
            <button class="phase-btn" onclick="pInfo(9)" style="border-color: #8e44ad;">120h+</button>
            <button class="phase-btn" onclick="pInfo(8)" style="border-color: #c0392b;">96-120h</button>
            <button class="phase-btn" onclick="pInfo(7)" style="border-color: #e74c3c;">72-96h</button>
            <button class="phase-btn" onclick="pInfo(6)" style="border-color: #e67e22;">60-72h</button>
            <button class="phase-btn" onclick="pInfo(5)" style="border-color: #f39c12;">48-60h</button>
        </div>

        <div id="dashboard">
            <svg viewBox="0 0 100 100">
                <circle class="bg-ring" cx="50" cy="50" r="45"></circle><circle id="ring1" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="283"></circle>
                <circle class="bg-ring" cx="50" cy="50" r="37"></circle><circle id="ring2" cx="50" cy="50" r="37" stroke-dasharray="232" stroke-dashoffset="232"></circle>
                <circle class="bg-ring" cx="50" cy="50" r="29"></circle><circle id="ring3" cx="50" cy="50" r="29" stroke-dasharray="182" stroke-dashoffset="182"></circle>
                <circle class="bg-ring" cx="50" cy="50" r="21"></circle><circle id="ring4" cx="50" cy="50" r="21" stroke-dasharray="132" stroke-dashoffset="132"></circle>
                <circle class="bg-ring" cx="50" cy="50" r="13"></circle><circle id="ring5" cx="50" cy="50" r="13" stroke-dasharray="82" stroke-dashoffset="82"></circle>
            </svg>
            <div id="center-info">
                <div id="phase-name">READY</div>
                <div id="biological-action">INITIATE FLOW</div>
            </div>
        </div>

        <div class="phase-column">
            <button class="phase-btn" onclick="pInfo(0)" style="border-color: #3498db;">0-4h</button>
            <button class="phase-btn" onclick="pInfo(1)" style="border-color: #1abc9c;">4-16h</button>
            <button class="phase-btn" onclick="pInfo(2)" style="border-color: #2ecc71;">16-24h</button>
            <button class="phase-btn" onclick="pInfo(3)" style="border-color: #a4db34;">24-36h</button>
            <button class="phase-btn" onclick="pInfo(4)" style="border-color: #f1c40f;">36-48h</button>
        </div>
    </div>

    <div class="timer-container" style="margin-top: 0;">
        <div class="shift-label" id="shift-label-el">BIO-SHIFT</div>
        <div id="next-shift">00:00:00</div>
    </div>

    <button id="action-btn" class="main-btn" onclick="handleActionButton()">START FASTING</button>

    <div id="history">
        <div class="history-header">
            <h3 style="margin:0; font-size: 0.9rem; letter-spacing: 2px;">HISTORY</h3>
            <button onclick="manualEntry()" style="background:none; border: 1px solid #333; color: #666; padding: 6px 15px; border-radius: 20px; font-size: 0.75rem;">+ MANUAL</button>
        </div>
        <div id="log-list"></div>
    </div>

    <script>
        const SCHEMA_VERSION = 3.4;
        let state = JSON.parse(localStorage.getItem('paleoFlowState')) || { version: SCHEMA_VERSION, isEating: false, startTime: null, logs: [] };

        if (state.version !== SCHEMA_VERSION) { 
            localStorage.removeItem('paleoFlowState'); 
            state = { version: SCHEMA_VERSION, isEating: false, startTime: null, logs: [] };
        }

        const phases = [
            { h: 4, name: "Anabolic", sub: "Exogenous Fuel", color: "#3498db", 
              vector: "Insulin elevated, glucose transport active. Body in storage mode.",
              sensory: "Satiety/Fullness. Possible mild post-meal energy dip.",
              caution: "None. Optimize nutrient density of the last meal." },
            { h: 16, name: "Catabolic", sub: "Glycogen Depletion", color: "#1abc9c", 
              vector: "Liver glycogen dropping. Fatty acid mobilization beginning.",
              sensory: "Cues peak at usual meal times. Mild stamina dip.",
              caution: "Hydrate. Salt intake helps mitigate early headaches." },
            { h: 24, name: "Ketosis Transition", sub: "GNG Switch", color: "#2ecc71", 
              vector: "Metabolic switch flipping. Liver creating glucose from non-carbs.",
              sensory: "The Hump. Irritability or mild fog common.",
              caution: "Protocol Warning: Medical awareness advised for flows >24h." },
            { h: 36, name: "Deep Ketosis", sub: "Brain-Fuel Shift", color: "#a4db34", 
              vector: "Brain using ketones (BHB). Reduced oxidative stress.",
              sensory: "Clarity sharpening. Metallic taste sign of ketosis.",
              caution: "Electrolyte imbalance risk. Target Sodium/Potassium/Magnesium." },
            { h: 48, name: "Keto-Adapted", sub: "Steady State", color: "#f1c40f", 
              vector: "Fat-burning engine efficient. Insulin sensitivity improving.",
              sensory: "Stable energy. Light physical sensation.",
              caution: "Lowered BP: Avoid rapid standing to prevent dizziness." },
            { h: 60, name: "Autophagy", sub: "Bulk Recycling", color: "#f39c12", 
              vector: "Macro-autophagy recycling damaged cellular components.",
              sensory: "Clearer skin. Possible heightened smell/taste.",
              caution: "Monitor physical weakness. Don't push through extreme exhaustion." },
            { h: 72, name: "Autophagy", sub: "CMA Precision", color: "#e67e22", 
              vector: "Targeted protein cleaning active. Precision recycling.",
              sensory: "Deep mental calm. Zen-like focus reported.",
              caution: "Professional oversight strongly advised beyond this threshold." },
            { h: 96, name: "Immune Reset", sub: "HSC Activation", color: "#e74c3c", 
              vector: "Old white blood cell recycling triggers stem cell production.",
              sensory: "Cold sensitivity. Prioritize light activity.",
              caution: "Avoid HIIT. Conserve energy for deep reconstruction." },
            { h: 120, name: "Centurion", sub: "Max Efficiency", color: "#c0392b", 
              vector: "Maximum repair velocity and protein conservation.",
              sensory: "Clean emptiness. Metabolic peak state.",
              caution: "Refeeding Hazard: Do NOT break flow with heavy carbs." },
            { h: 999, name: "Master", sub: "Peak Repair", color: "#8e44ad", 
              vector: "Profound longevity state and deep rejuvenation.",
              sensory: "Euphoric clarity. Extended metabolic flexibility.",
              caution: "Refeeding Syndrome Risk: Expert protocols and slow re-entry required." }
        ];

        function pInfo(i) {
            const p = phases[i];
            alert(`PHASE ${i + 1}: ${p.name.toUpperCase()}\n¬´ BIOLOGICAL VECTOR ¬ª\n${p.vector}\n\n¬´ SENSORY FEEDBACK ¬ª\n${p.sensory}\n\n¬´ PROTOCOL CAUTION ¬ª\n${p.caution}`);
        }

        function formatTime(s) {
            const h = Math.floor(s / 3600).toString().padStart(2, '0');
            const m = Math.floor((s % 3600) / 60).toString().padStart(2, '0');
            const sec = Math.floor(s % 60).toString().padStart(2, '0');
            return `${h}:${m}:${sec}`;
        }

        function save() { localStorage.setItem('paleoFlowState', JSON.stringify(state)); }

        function updateSpectrumWave(curIdx) {
            const labelEl = document.getElementById('shift-label-el');
            if (!labelEl) return;
            const activeIdx = curIdx === -1 ? 9 : curIdx;
            let stops = [];
            for (let i = 0; i <= activeIdx; i++) { stops.push(phases[i].color); }
            const fullGradient = [...stops, ...stops.slice().reverse()].join(', ');
            labelEl.style.background = `linear-gradient(90deg, ${fullGradient})`;
            labelEl.style.backgroundSize = "300% auto";
            labelEl.style.webkitBackgroundClip = "text";
            labelEl.style.filter = `drop-shadow(0 0 12px ${phases[activeIdx].color}88)`;
        }

        function handleActionButton() {
            if (state.logs.length === 0) {
                const now = new Date();
                const tStr = prompt("Last meal end time (MM/DD HH:MM):", `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`);
                if (tStr) {
                    try {
                        const [dp, tp] = tStr.split(' '); const [m, d] = dp.split('/'); const [h, mi] = tp.split(':');
                        const start = new Date(); start.setMonth(parseInt(m)-1); start.setDate(parseInt(d)); start.setHours(parseInt(h)); start.setMinutes(parseInt(mi));
                        if (start.getTime() > Date.now()) { alert("Future time blocked."); return; }
                        state.startTime = start.getTime(); state.isEating = false;
                        state.logs.unshift({ label: "Finished Eating", time: state.startTime, id: state.startTime });
                        save(); renderLogs(); updateUI();
                    } catch(e) { alert("Format Error"); }
                }
            } else {
                const now = Date.now(); state.isEating = !state.isEating; state.startTime = now;
                state.logs.unshift({ label: state.isEating ? "Started Eating" : "Finished Eating", time: now, id: now });
                save(); renderLogs(); updateUI();
            }
        }

        function updateUI() {
            const btn = document.getElementById('action-btn');
            if (state.logs.length === 0) { btn.innerText = "START FASTING"; return; }
            const diff = (Date.now() - state.startTime) / 1000; const hours = Math.max(0, diff / 3600);
            document.getElementById('total-flow').innerText = formatTime(diff);
            const curIdx = phases.findIndex(p => hours < p.h); const curP = phases[curIdx] || phases[9];
            
            updateSpectrumWave(curIdx);
            
            const labelEl = document.getElementById('shift-label-el');
            if (!state.isEating && curIdx < 9 && curIdx !== -1) {
                const secToNext = (curP.h * 3600) - diff;
                document.getElementById('next-shift').innerText = formatTime(Math.max(0, secToNext));
                labelEl.style.animationDuration = secToNext < 3600 ? '1s' : '4s';
            } else { 
                document.getElementById('next-shift').innerText = "00:00:00"; 
                labelEl.style.animationDuration = '4s';
            }
            
            document.getElementById('phase-name').innerText = state.isEating ? "BUILDING" : curP.name;
            document.getElementById('biological-action').innerText = state.isEating ? "NUTRIENT LOADING" : curP.sub;
            btn.innerText = state.isEating ? "FINISH EATING" : "START EATING";
            
            [1,2,3,4,5].forEach((n, i) => {
                const rh = hours - (i * 24); const pct = state.isEating ? 0 : Math.min(Math.max((rh / 24) * 100, 0), 100);
                const el = document.getElementById('ring' + n); const circ = [283, 232, 182, 132, 82][i];
                el.style.strokeDashoffset = circ - (pct / 100) * circ; el.style.stroke = state.isEating ? "#111" : curP.color;
            });
        }

        function renderLogs() {
            const list = document.getElementById('log-list'); if (!list) return;
            list.innerHTML = state.logs.map(e => `<div class="log-entry"><div><strong>${e.label}</strong><br><small style="color:#444">${new Date(e.time).toLocaleString()}</small></div><button style="background:#222; border:none; color:white; padding:8px 12px; border-radius:10px;" onclick="deleteLog(${e.id})">üóëÔ∏è</button></div>`).join('');
        }

        function deleteLog(id) { if(confirm("Delete?")) { state.logs = state.logs.filter(e => e.id !== id); if(state.logs.length) { state.startTime = state.logs[0].time; state.isEating = state.logs[0].label === "Started Eating"; } else { state.startTime = null; state.isEating = false;} save(); renderLogs(); updateUI(); } }

        function manualEntry() {
            const label = confirm("Started Eating? (Cancel for Finished)") ? "Started Eating" : "Finished Eating";
            const timeStr = prompt("Date/Time (MM/DD HH:MM):", `${new Date().getMonth()+1}/${new Date().getDate()} ${new Date().getHours()}:${new Date().getMinutes()}`);
            if (timeStr) {
                try {
                    const [dp, tp] = timeStr.split(' '); const [m, d] = dp.split('/'); const [h, min] = tp.split(':');
                    const entryDate = new Date(); entryDate.setMonth(parseInt(m)-1); entryDate.setDate(parseInt(d)); entryDate.setHours(parseInt(h)); entryDate.setMinutes(parseInt(min));
                    const newId = entryDate.getTime(); state.logs.push({ label, time: newId, id: newId });
                    state.logs.sort((a,b) => b.time - a.time); if (state.logs[0].id === newId) { state.startTime = newId; state.isEating = (label === "Started Eating"); }
                    save(); renderLogs(); updateUI();
                } catch(e) { alert("Format Error"); }
            }
        }

        setInterval(updateUI, 1000);
        renderLogs(); updateUI();
    </script>
</body>
</html>
