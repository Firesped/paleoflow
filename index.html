<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaleoFlow Centurion</title>
    <style>
        :root {
            --ring-bg: #1a1a1a;
            --color-1: #3498db; /* Day 1: Blue */
            --color-2: #2ecc71; /* Day 2: Green */
            --color-3: #f1c40f; /* Day 3: Yellow */
            --color-4: #e67e22; /* Day 4: Orange */
            --color-5: #e74c3c; /* Day 5: Red */
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #000; color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* Dashboard */
        #dashboard { position: relative; width: 320px; height: 320px; margin: 20px 0; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 7; stroke-linecap: round; transition: stroke-dashoffset 0.8s ease-out; }
        .bg-ring { stroke: var(--ring-bg); }
        
        #center-info {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; width: 200px;
        }
        #phase-name { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: #888; margin-bottom: 8px; font-weight: bold; }
        #timer { font-size: 2.4rem; font-weight: 800; font-variant-numeric: tabular-nums; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
        
        /* Actions */
        .main-btn { background: white; color: black; border: none; padding: 18px 40px; border-radius: 50px; font-weight: 900; font-size: 1.1rem; margin-top: 30px; width: 100%; max-width: 300px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); cursor: pointer; }
        .main-btn:active { transform: scale(0.96); }

        /* History */
        #log { width: 100%; max-width: 450px; margin-top: 50px; text-align: left; }
        .history-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #222; padding-bottom: 10px; margin-bottom: 15px; }
        .log-entry { border-bottom: 1px solid #1a1a1a; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .log-time { font-size: 0.8rem; color: #555; }
        .metric-pill { font-size: 0.7rem; color: #aaa; margin-top: 4px; background: #111; padding: 2px 8px; border-radius: 4px; display: inline-block; }
        .row-btns { display: flex; gap: 8px; }
        .icon-btn { background: #222; border: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.7rem; cursor: pointer; }
        .del-btn { background: #331111; color: #ff5555; }

        footer { margin-top: auto; padding: 40px 20px; font-size: 0.65rem; color: #444; text-align: center; line-height: 1.4; }
    </style>
</head>
<body>

    <div id="dashboard">
        <svg viewBox="0 0 100 100">
            <circle class="bg-ring" cx="50" cy="50" r="45"></circle>
            <circle id="ring1" stroke="var(--color-1)" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="283"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="37"></circle>
            <circle id="ring2" stroke="var(--color-2)" cx="50" cy="50" r="37" stroke-dasharray="232" stroke-dashoffset="232"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="29"></circle>
            <circle id="ring3" stroke="var(--color-3)" cx="50" cy="50" r="29" stroke-dasharray="182" stroke-dashoffset="182"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="21"></circle>
            <circle id="ring4" stroke="var(--color-4)" cx="50" cy="50" r="21" stroke-dasharray="132" stroke-dashoffset="132"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="13"></circle>
            <circle id="ring5" stroke="var(--color-5)" cx="50" cy="50" r="13" stroke-dasharray="82" stroke-dashoffset="82"></circle>
        </svg>
        <div id="center-info">
            <div id="phase-name">READY</div>
            <div id="timer">00:00:00</div>
        </div>
    </div>

    <button id="action-btn" class="main-btn" onclick="toggleState()">START EATING</button>

    <div id="log">
        <div class="history-header">
            <h3 style="margin:0;">FLOW HISTORY</h3>
            <button onclick="manualEntry()" style="background:none; border: 1px solid #333; color: #666; padding: 5px 12px; border-radius: 20px; font-size: 0.7rem; cursor: pointer;">+ MANUAL</button>
        </div>
        <div id="log-list"></div>
    </div>

    <footer>
        <p>&copy; 2026 PaleoFlow. All Rights Reserved.</p>
        <p>Your data is stored locally. This is a tracking tool, not medical advice.</p>
    </footer>

    <script>
        const SCHEMA_VERSION = 1.3;
        let state = JSON.parse(localStorage.getItem('paleoFlowState')) || { version: SCHEMA_VERSION, isEating: false, startTime: null, logs: [] };

        if (state.version !== SCHEMA_VERSION) {
            localStorage.removeItem('paleoFlowState');
            location.reload();
        }

        function save() { localStorage.setItem('paleoFlowState', JSON.stringify(state)); }

        function toggleState() {
            const now = new Date().getTime();
            state.isEating = !state.isEating;
            state.startTime = now;
            const label = state.isEating ? "Started Eating" : "Finished Eating";
            state.logs.unshift({ label, time: now, id: now, metrics: { glucose: null, blood: null, breath: null, urine: null } });
            save();
            renderLogs();
            updateUI();
        }

        function setRing(id, percent, circumference) {
            const offset = circumference - (percent / 100) * circumference;
            document.getElementById(id).style.strokeDashoffset = offset;
        }

        function updateUI() {
            const timerEl = document.getElementById('timer');
            const phaseEl = document.getElementById('phase-name');
            const btn = document.getElementById('action-btn');
            
            if (!state.startTime) {
                timerEl.innerText = "00:00:00";
                phaseEl.innerText = "READY";
                return;
            }
            
            const now = new Date().getTime();
            const diff = (now - state.startTime) / 1000;
            const hours = Math.max(0, diff / 3600);

            const h = Math.floor(hours).toString().padStart(2, '0');
            const m = Math.floor((Math.abs(diff) % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(Math.abs(diff) % 60).toString().padStart(2, '0');
            timerEl.innerText = `${h}:${m}:${s}`;
            
            btn.innerText = state.isEating ? "FINISH EATING" : "START EATING";

            if (state.isEating) {
                phaseEl.innerText = "Building";
                [1,2,3,4,5].forEach((i, idx) => setRing('ring'+i, 0, [283,232,182,132,82][idx]));
            } else {
                setRing('ring1', Math.min((hours / 24) * 100, 100), 283);
                setRing('ring2', Math.max(0, Math.min(((hours - 24) / 24) * 100, 100)), 232);
                setRing('ring3', Math.max(0, Math.min(((hours - 48) / 24) * 100, 100)), 182);
                setRing('ring4', Math.max(0, Math.min(((hours - 72) / 24) * 100, 100)), 132);
                setRing('ring5', Math.max(0, Math.min(((hours - 96) / 24) * 100, 100)), 82);

                if (hours < 24) phaseEl.innerText = "Day 1: Induction";
                else if (hours < 48) phaseEl.innerText = "Day 2: Ketosis";
                else if (hours < 72) phaseEl.innerText = "Day 3: Autophagy";
                else if (hours < 96) phaseEl.innerText = "Day 4: Deep Repair";
                else phaseEl.innerText = "Day 5: Centurion";
            }
        }

        function editLog(id) {
            const log = state.logs.find(l => l.id === id);
            const d = new Date(log.time);
            const currentStr = `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2,'0')}`;
            const newTime = prompt(`Edit Date/Time (MM/DD HH:MM):`, currentStr);
            if (newTime) {
                const [datePart, timePart] = newTime.split(' ');
                const [m, day] = datePart.split('/');
                const [h, min] = timePart.split(':');
                const editDate = new Date();
                editDate.setMonth(parseInt(m)-1); editDate.setDate(parseInt(day));
                editDate.setHours(parseInt(h)); editDate.setMinutes(parseInt(min));
                log.time = editDate.getTime();
                if (state.logs[0].id === id) state.startTime = log.time;
            }
            log.metrics.glucose = prompt("Glucose:", log.metrics.glucose || "");
            log.metrics.blood = prompt("Blood Ketones:", log.metrics.blood || "");
            save(); renderLogs(); updateUI();
        }

        function deleteLog(id) {
            if (confirm("Delete entry?")) {
                state.logs = state.logs.filter(l => l.id !== id);
                if (state.logs.length > 0) {
                    state.startTime = state.logs[0].time;
                    state.isEating = (state.logs[0].label === "Started Eating");
                } else { state.startTime = null; state.isEating = false; }
                save(); renderLogs(); updateUI();
            }
        }

        function manualEntry() {
            const label = confirm("Started Eating? (Cancel for Finished)") ? "Started Eating" : "Finished Eating";
            const now = new Date();
            const timeStr = prompt("Date/Time (MM/DD HH:MM):", `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes()}`);
            if (timeStr) {
                const [datePart, timePart] = timeStr.split(' ');
                const [m, day] = datePart.split('/');
                const [h, min] = timePart.split(':');
                const entryDate = new Date();
                entryDate.setMonth(parseInt(m)-1); entryDate.setDate(parseInt(day));
                entryDate.setHours(parseInt(h)); entryDate.setMinutes(parseInt(min));
                const newId = entryDate.getTime();
                state.logs.push({ label, time: newId, id: newId, metrics: { glucose: null, blood: null, breath: null, urine: null } });
                state.logs.sort((a,b) => b.time - a.time);
                if (state.logs[0].id === newId) { state.startTime = newId; state.isEating = (label === "Started Eating"); }
                save(); renderLogs(); updateUI();
            }
        }

        function renderLogs() {
            const list = document.getElementById('log-list');
            list.innerHTML = state.logs.map(entry => {
                const m = entry.metrics;
                const d = new Date(entry.time);
                const metrics = (m.glucose || m.blood) ? `<br><span class="metric-pill">G: ${m.glucose || '-'} | K: ${m.blood || '-'}</span>` : '';
                return `
                <div class="log-entry">
                    <div style="flex-grow:1;">
                        <strong>${entry.label}</strong><br>
                        <span class="log-time">${d.toLocaleDateString([], {month:'short', day:'numeric'})}, ${d.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'})}</span>
                        ${metrics}
                    </div>
                    <div class="row-btns">
                        <button class="icon-btn" onclick="editLog(${entry.id})">EDIT</button>
                        <button class="icon-btn del-btn" onclick="deleteLog(${entry.id})">üóëÔ∏è</button>
                    </div>
                </div>`;
            }).join('');
        }

        setInterval(updateUI, 1000);
        renderLogs();
        updateUI();
    </script>
</body>
</html>
