<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaleoFlow Centurion</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: #000; color: white; padding: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; margin: 0; overflow-x: hidden;
        }

        /* --- STYLIZED FLOW (Blue Wave) --- */
        .timer-container { text-align: center; margin-top: 10px; }
        .label { font-size: 0.7rem; color: #666; text-transform: uppercase; letter-spacing: 5px; font-weight: 900; }

        #total-flow { 
            font-size: 4.5rem; font-weight: 900; line-height: 1; letter-spacing: -2px;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5, #00d2ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: wave-blue 3s linear infinite;
            filter: drop-shadow(0 0 10px rgba(0, 210, 255, 0.5));
        }

        @keyframes wave-blue {
            to { background-position: 200% center; }
        }

        /* --- STYLIZED BIO-SHIFT (Rainbow Pulse) --- */
        #next-shift { 
            font-family: 'Courier New', Courier, monospace;
            font-size: 2rem; font-weight: bold;
            color: #fff;
            animation: rainbow-pulse 4s ease-in-out infinite;
            padding: 5px 15px;
            border-radius: 10px;
        }

        @keyframes rainbow-pulse {
            0% { text-shadow: 0 0 5px #e74c3c; color: #e74c3c; } /* Red */
            25% { text-shadow: 0 0 15px #e67e22; color: #e67e22; } /* Orange */
            50% { text-shadow: 0 0 25px #f1c40f; color: #f1c40f; } /* Yellow */
            75% { text-shadow: 0 0 15px #2ecc71; color: #2ecc71; } /* Green */
            100% { text-shadow: 0 0 5px #e74c3c; color: #e74c3c; }
        }

        /* --- DASHBOARD --- */
        #dashboard { position: relative; width: 300px; height: 300px; margin: 15px 0; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; transition: all 0.8s ease; }
        .bg-ring { stroke: #111; }
        
        #center-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 220px; }
        #phase-name { font-size: 1.2rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
        #biological-action { font-size: 0.7rem; color: #555; font-weight: bold; margin-top: 5px; }

        .main-btn { background: #fff; color: #000; border: none; padding: 20px 50px; border-radius: 50px; font-weight: 900; font-size: 1.1rem; margin-top: 20px; cursor: pointer; letter-spacing: 2px; }
        
        #history { width: 100%; max-width: 450px; margin-top: 40px; text-align: left; }
        .log-entry { border-bottom: 1px solid #1a1a1a; padding: 12px 0; display: flex; justify-content: space-between; align-items: center; }
        .icon-btn { background: #222; border: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div class="timer-container">
        <div class="label">Flow</div>
        <div id="total-flow">00:00:00</div>
    </div>

    <div id="dashboard">
        <svg viewBox="0 0 100 100">
            <circle class="bg-ring" cx="50" cy="50" r="45"></circle><circle id="ring1" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="283"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="37"></circle><circle id="ring2" cx="50" cy="50" r="37" stroke-dasharray="232" stroke-dashoffset="232"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="29"></circle><circle id="ring3" cx="50" cy="50" r="29" stroke-dasharray="182" stroke-dashoffset="182"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="21"></circle><circle id="ring4" cx="50" cy="50" r="21" stroke-dasharray="132" stroke-dashoffset="132"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="13"></circle><circle id="ring5" cx="50" cy="50" r="13" stroke-dasharray="82" stroke-dashoffset="82"></circle>
        </svg>
        <div id="center-info">
            <div id="phase-name">READY</div>
            <div id="biological-action">AWAITING SHIFT</div>
        </div>
    </div>

    <div class="timer-container">
        <div class="label">Bio-Shift</div>
        <div id="next-shift">00:00:00</div>
    </div>

    <button id="action-btn" class="main-btn" onclick="handleActionButton()">START FASTING</button>

    <div id="history">
        <div style="display: flex; justify-content: space-between; border-bottom: 2px solid #222; padding-bottom: 10px;">
            <h3 style="margin:0; font-size: 0.9rem;">HISTORY</h3>
            <button onclick="manualEntry()" style="background:none; border: 1px solid #333; color: #666; padding: 2px 10px; border-radius: 10px; font-size: 0.7rem;">+ MANUAL</button>
        </div>
        <div id="log-list"></div>
    </div>

    <script>
        const SCHEMA_VERSION = 2.3;
        let state = JSON.parse(localStorage.getItem('paleoFlowState')) || { version: SCHEMA_VERSION, isEating: false, startTime: null, logs: [] };

        if (state.version !== SCHEMA_VERSION) { localStorage.removeItem('paleoFlowState'); location.reload(); }

        const phases = [
            { h: 4, name: "Anabolic", sub: "Exogenous Fuel", color: "#3498db" },
            { h: 16, name: "Catabolic", sub: "Glycogen Depletion", color: "#1abc9c" },
            { h: 24, name: "Ketosis Transition", sub: "GNG Switch", color: "#2ecc71" },
            { h: 36, name: "Deep Ketosis", sub: "Brain-Fuel Shift", color: "#a4db34" },
            { h: 48, name: "Keto-Adapted", sub: "Steady State", color: "#f1c40f" },
            { h: 60, name: "Autophagy", sub: "Bulk Recycling", color: "#f39c12" },
            { h: 72, name: "Autophagy", sub: "CMA Precision", color: "#e67e22" },
            { h: 96, name: "Immune Reset", sub: "HSC Activation", color: "#e74c3c" },
            { h: 120, name: "Centurion", sub: "Max Efficiency", color: "#c0392b" },
            { h: 999, name: "Master", sub: "Peak Repair", color: "#8e44ad" }
        ];

        function formatTime(sec) {
            const h = Math.floor(sec / 3600).toString().padStart(2, '0');
            const m = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(sec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function handleActionButton() {
            if (state.logs.length === 0) {
                const now = new Date();
                const defaultTime = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`;
                const timeStr = prompt("Last meal end time (MM/DD HH:MM):", defaultTime);
                if (timeStr) {
                    const [dp, tp] = timeStr.split(' ');
                    const [m, d] = dp.split('/');
                    const [h, min] = tp.split(':');
                    const start = new Date();
                    start.setMonth(parseInt(m)-1); start.setDate(parseInt(d));
                    start.setHours(parseInt(h)); start.setMinutes(parseInt(min));
                    if (start.getTime() > Date.now()) { alert("Future time blocked."); return; }
                    state.startTime = start.getTime();
                    state.isEating = false;
                    state.logs.unshift({ label: "Finished Eating", time: state.startTime, id: state.startTime, metrics: { glucose: null, blood: null } });
                    save(); renderLogs(); updateUI();
                }
            } else {
                const now = Date.now();
                state.isEating = !state.isEating;
                state.startTime = now;
                state.logs.unshift({ label: state.isEating ? "Started Eating" : "Finished Eating", time: now, id: now, metrics: { glucose: null, blood: null } });
                save(); renderLogs(); updateUI();
            }
        }

        function updateUI() {
            const btn = document.getElementById('action-btn');
            if (state.logs.length === 0) { btn.innerText = "START FASTING"; return; }
            
            const diff = (Date.now() - state.startTime) / 1000;
            const hours = Math.max(0, diff / 3600);
            document.getElementById('total-flow').innerText = formatTime(diff);

            const curIdx = phases.findIndex(p => hours < p.h);
            const curP = phases[curIdx] || phases[phases.length - 1];
            
            if (!state.isEating && curIdx < phases.length - 1) {
                document.getElementById('next-shift').innerText = formatTime(Math.max(0, (curP.h * 3600) - diff));
            } else {
                document.getElementById('next-shift').innerText = "00:00:00";
            }

            document.getElementById('phase-name').innerText = state.isEating ? "BUILDING" : curP.name.toUpperCase();
            document.getElementById('biological-action').innerText = state.isEating ? "NUTRIENT LOADING" : curP.sub.toUpperCase();
            btn.innerText = state.isEating ? "FINISH EATING" : "START EATING";

            [1,2,3,4,5].forEach((num, idx) => {
                const ringHours = hours - (idx * 24);
                const pct = state.isEating ? 0 : Math.min(Math.max((ringHours / 24) * 100, 0), 100);
                const el = document.getElementById('ring' + num);
                const circ = [283, 232, 182, 132, 82][idx];
                el.style.strokeDashoffset = circ - (pct / 100) * circ;
                el.style.stroke = state.isEating ? "#111" : curP.color;
            });
        }

        function save() { localStorage.setItem('paleoFlowState', JSON.stringify(state)); }
        function renderLogs() {
            document.getElementById('log-list').innerHTML = state.logs.map(e => `
                <div class="log-entry">
                    <div><strong>${e.label}</strong><br><small style="color:#444">${new Date(e.time).toLocaleString()}</small></div>
                    <button class="icon-btn" onclick="deleteLog(${e.id})">üóëÔ∏è</button>
                </div>`).join('');
        }
        function deleteLog(id) { if(confirm("Delete?")) { state.logs = state.logs.filter(e => e.id !== id); if(state.logs.length) { state.startTime = state.logs[0].time; state.isEating = state.logs[0].label === "Started Eating"; } else { state.startTime = null; } save(); renderLogs(); updateUI(); } }
        
        setInterval(updateUI, 1000);
        renderLogs(); updateUI();
    </script>
</body>
</html>
