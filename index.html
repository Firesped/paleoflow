<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaleoFlow Centurion</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #000; color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        
        /* Layout Structure */
        .timer-container { text-align: center; margin-top: 20px; }
        .label { font-size: 0.75rem; color: #666; text-transform: uppercase; letter-spacing: 3px; font-weight: 900; margin-bottom: 5px; }
        #total-flow { font-size: 3.5rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; }
        #next-shift { font-size: 1.5rem; color: #888; font-variant-numeric: tabular-nums; margin-top: 5px; }

        #dashboard { position: relative; width: 320px; height: 320px; margin: 20px 0; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 7; stroke-linecap: round; transition: stroke-dashoffset 0.8s ease-out, stroke 0.8s ease; }
        .bg-ring { stroke: #111; }
        
        #center-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 220px; }
        #phase-name { font-size: 1.1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        #biological-action { font-size: 0.7rem; color: #555; font-weight: 600; margin-top: 4px; }
        
        #safety-advisory { font-size: 0.6rem; color: #ffcc00; background: rgba(255,204,0,0.1); padding: 5px 10px; border-radius: 5px; margin-top: 15px; display: none; border: 1px solid rgba(255,204,0,0.2); max-width: 160px; margin-left: auto; margin-right: auto; }

        .main-btn { background: white; color: black; border: none; padding: 20px 40px; border-radius: 50px; font-weight: 900; font-size: 1.2rem; margin-top: 20px; width: 100%; max-width: 320px; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .main-btn:active { transform: scale(0.96); }

        #history { width: 100%; max-width: 450px; margin-top: 50px; text-align: left; padding-bottom: 50px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #222; padding-bottom: 10px; }
        .log-entry { border-bottom: 1px solid #1a1a1a; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .row-btns { display: flex; gap: 8px; }
        .icon-btn { background: #222; border: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.7rem; cursor: pointer; }
        
        footer { margin-top: auto; padding: 30px; border-top: 1px solid #222; font-size: 0.7rem; color: #444; width: 100%; text-align: center; }
        footer a { color: #555; text-decoration: none; margin: 0 5px; }
    </style>
</head>
<body>

    <div class="timer-container">
        <div class="label">Flow</div>
        <div id="total-flow">00:00:00</div>
    </div>

    <div id="dashboard">
        <svg viewBox="0 0 100 100">
            <circle class="bg-ring" cx="50" cy="50" r="45"></circle><circle id="ring1" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="283"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="37"></circle><circle id="ring2" cx="50" cy="50" r="37" stroke-dasharray="232" stroke-dashoffset="232"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="29"></circle><circle id="ring3" cx="50" cy="50" r="29" stroke-dasharray="182" stroke-dashoffset="182"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="21"></circle><circle id="ring4" cx="50" cy="50" r="21" stroke-dasharray="132" stroke-dashoffset="132"></circle>
            <circle class="bg-ring" cx="50" cy="50" r="13"></circle><circle id="ring5" cx="50" cy="50" r="13" stroke-dasharray="82" stroke-dashoffset="82"></circle>
        </svg>
        <div id="center-info">
            <div id="phase-name">READY</div>
            <div id="biological-action">Awaiting Shift</div>
            <div id="safety-advisory">ADVISORY: Medical supervision recommended for flows over 24h.</div>
        </div>
    </div>

    <div class="timer-container" style="margin-top: 0;">
        <div class="label" style="letter-spacing: 2px;">Bio-Shift</div>
        <div id="next-shift">00:00:00</div>
    </div>

    <button id="action-btn" class="main-btn" onclick="toggleState()">START EATING</button>

    <div id="history">
        <div class="history-header">
            <h3 style="margin:0; font-size: 0.9rem; letter-spacing: 1px;">HISTORY</h3>
            <button onclick="manualEntry()" style="background:none; border: 1px solid #333; color: #666; padding: 5px 12px; border-radius: 20px; font-size: 0.7rem; cursor: pointer;">+ MANUAL</button>
        </div>
        <div id="log-list"></div>
    </div>

    <footer>
        <p>&copy; 2026 PaleoFlow. All Rights Reserved.</p>
        <a href="https://pubmed.ncbi.nlm.nih.gov/24440038/">Science</a> | <a href="#">Terms</a> | <a href="#">Privacy</a>
    </footer>

    <script>
        const SCHEMA_VERSION = 1.9;
        let state = JSON.parse(localStorage.getItem('paleoFlowState')) || { version: SCHEMA_VERSION, isEating: false, startTime: null, logs: [] };

        if (state.version !== SCHEMA_VERSION) { localStorage.removeItem('paleoFlowState'); location.reload(); }

        const phases = [
            { h: 4, name: "Anabolic", sub: "Exogenous Fuel", color: "#3498db" },
            { h: 16, name: "Catabolic", sub: "Glycogen Depletion", color: "#1abc9c" },
            { h: 24, name: "Ketosis Transition", sub: "GNG Switch", color: "#2ecc71" },
            { h: 36, name: "Deep Ketosis", sub: "Brain-Fuel Shift", color: "#a4db34" },
            { h: 48, name: "Keto-Adapted", sub: "Steady State", color: "#f1c40f" },
            { h: 60, name: "Autophagy", sub: "Bulk Recycling", color: "#f39c12" },
            { h: 72, name: "Autophagy", sub: "CMA Precision", color: "#e67e22" },
            { h: 96, name: "Immune Reset", sub: "HSC Activation", color: "#e74c3c" },
            { h: 120, name: "Centurion", sub: "Max Efficiency", color: "#c0392b" },
            { h: 999, name: "Master", sub: "Peak Repair", color: "#8e44ad" }
        ];

        function save() { localStorage.setItem('paleoFlowState', JSON.stringify(state)); }

        function formatTime(sec) {
            const h = Math.floor(sec / 3600).toString().padStart(2, '0');
            const m = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(sec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function toggleState() {
            const now = Date.now();
            state.isEating = !state.isEating;
            state.startTime = now;
            state.logs.unshift({ label: state.isEating ? "Started Eating" : "Finished Eating", time: now, id: now, metrics: { glucose: null, blood: null } });
            save(); renderLogs(); updateUI();
        }

        function setRing(id, percent, circumference, color) {
            const el = document.getElementById(id);
            el.style.strokeDashoffset = circumference - (percent / 100) * circumference;
            el.style.stroke = color;
        }

        function updateUI() {
            if (!state.startTime) return;
            const diff = (Date.now() - state.startTime) / 1000;
            const hours = Math.max(0, diff / 3600);
            
            document.getElementById('total-flow').innerText = formatTime(diff);
            
            const currentPhaseIndex = phases.findIndex(p => hours < p.h);
            const currentPhase = phases[currentPhaseIndex] || phases[phases.length - 1];
            
            const bioShiftEl = document.getElementById('next-shift');
            if (!state.isEating && currentPhaseIndex < phases.length - 1) {
                const secRemaining = (currentPhase.h * 3600) - diff;
                bioShiftEl.innerText = formatTime(Math.max(0, secRemaining));
            } else {
                bioShiftEl.innerText = "00:00:00";
            }

            const phaseEl = document.getElementById('phase-name');
            const subEl = document.getElementById('biological-action');
            const advisoryEl = document.getElementById('safety-advisory');

            if (state.isEating) {
                phaseEl.innerText = "Building";
                subEl.innerText = "Nutrient Loading";
                advisoryEl.style.display = 'none';
                [1,2,3,4,5].forEach((i, idx) => setRing('ring'+i, 0, [283,232,182,132,82][idx], "#111"));
            } else {
                phaseEl.innerText = currentPhase.name;
                subEl.innerText = currentPhase.sub;
                advisoryEl.style.display = hours >= 24 ? 'block' : 'none';
                
                const circs = [283, 232, 182, 132, 82];
                [1,2,3,4,5].forEach((i, idx) => {
                    const ringHours = (hours - (idx * 24));
                    const percent = Math.min(Math.max((ringHours / 24) * 100, 0), 100);
                    setRing('ring'+i, percent, circs[idx], currentPhase.color);
                });
            }
            document.getElementById('action-btn').innerText = state.isEating ? "FINISH EATING" : "START EATING";
        }

        function renderLogs() {
            const list = document.getElementById('log-list');
            list.innerHTML = state.logs.map(entry => `
                <div class="log-entry">
                    <div style="flex-grow:1;">
                        <strong>${entry.label}</strong><br>
                        <span style="font-size:0.8rem; color:#555;">${new Date(entry.time).toLocaleString([], {month:'short', day:'numeric', hour:'numeric', minute:'2-digit'})}</span>
                    </div>
                    <div class="row-btns">
                        <button class="icon-btn" onclick="editLog(${entry.id})">EDIT</button>
                        <button class="icon-btn" onclick="deleteLog(${entry.id})" style="color:#ff5555;">üóëÔ∏è</button>
                    </div>
                </div>`).join('');
        }

        function manualEntry() {
            const label = confirm("Started Eating? (Cancel for Finished)") ? "Started Eating" : "Finished Eating";
            const timeStr = prompt("Date/Time (MM/DD HH:MM):", `${new Date().getMonth()+1}/${new Date().getDate()} ${new Date().getHours()}:${new Date().getMinutes()}`);
            if (timeStr) {
                const [dPart, tPart] = timeStr.split(' ');
                const [m, d] = dPart.split('/');
                const [h, min] = tPart.split(':');
                const entryDate = new Date();
                entryDate.setMonth(parseInt(m)-1); entryDate.setDate(parseInt(d));
                entryDate.setHours(parseInt(h)); entryDate.setMinutes(parseInt(min));
                const newId = entryDate.getTime();
                state.logs.push({ label, time: newId, id: newId, metrics: { glucose: null, blood: null } });
                state.logs.sort((a,b) => b.time - a.time);
                if (state.logs[0].id === newId) { state.startTime = newId; state.isEating = (label === "Started Eating"); }
                save(); renderLogs(); updateUI();
            }
        }

        function editLog(id) {
            const log = state.logs.find(l => l.id === id);
            const d = new Date(log.time);
            const newTime = prompt(`Edit (MM/DD HH:MM):`, `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes()}`);
            if (newTime) {
                const [dp, tp] = newTime.split(' ');
                const [m, day] = dp.split('/');
                const [h, min] = tp.split(':');
                const ed = new Date();
                ed.setMonth(parseInt(m)-1); ed.setDate(parseInt(day));
                ed.setHours(parseInt(h)); ed.setMinutes(parseInt(min));
                log.time = ed.getTime();
                if (state.logs[0].id === id) state.startTime = ed.getTime();
            }
            save(); renderLogs(); updateUI();
        }

        function deleteLog(id) {
            if (confirm("Delete entry?")) {
                state.logs = state.logs.filter(l => l.id !== id);
                if (state.logs.length > 0) {
                    state.startTime = state.logs[0].time;
                    state.isEating = (state.logs[0].label === "Started Eating");
                } else { state.startTime = null; state.isEating = false; }
                save(); renderLogs(); updateUI();
            }
        }

        setInterval(updateUI, 1000);
        renderLogs(); updateUI();
    </script>
</body>
</html>
